<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>AvalonBootstrap</title>
<link href="css/bootstrap/bootstrap.css" rel="stylesheet">
<link href="css/demo.css" rel="stylesheet">
</head>
<body ms-controller='demo'>
<div class='project-header'>
	<div class='container'>
		<h1>AvalonBootstrap</h1>
		<p class='project-des'>用avalon做一些基于bootstrap的组件</p>
	</div>
</div>
<div class="container">
	<div class='row'>
		<div class='col-sm-3'>
			<div class="list-group">
				<a href="javascript:void(0)" class="list-group-item" ms-repeat='items' 
					ms-class='active:curIndex === $index' ms-click='changeIndex($index)'>{{el.text}}</a>
			</div>
		</div>
		<div class='col-sm-9' id='content'>
			<div ms-repeat='items' class='mitem' ms-class='active:curIndex === $index' ms-data-index='$index'>
				<h2 ms-if='el.loading' class='text-center'>加载{{el.text}}中...</h2>
			</div>
		</div>
	</div>
</div>
<div class='project-footer text-center'>
	power by weeksun23 <a href='https://github.com/weeksun23' target='_blank'>Github</a>
</div>
<script src='src/avalon.js'></script>
<script>
	(function(){
		var items = [{
			text : "accordion"
		},{
			text : "dialog"
		},{
			text : "dropdown"
		},{
			text : "popover"
		},{
			text : "tab"
		},{
			text : "table"
		},{
			text : "tooltip"
		},{
			text : "tree"
		}];
		avalon.each(items,function(i,j){
			j.$init = false;
			j.loading = false;
		});
		var bodyVm = avalon.define({
			$id : "demo",
			curIndex : -1,
			items : items,
			changeIndex : function(i){
				var target = bodyVm.items[i];
				if(!target.$init){
					target.$init = true;
					var content = document.getElementById("content");
					var targetNode;
					avalon.each(content.childNodes,function(j,node){
						if(node.nodeType === 1 && +node.getAttribute("data-index") === i){
							targetNode = node;
							return false;
						}
					});
					target.loading = true;
					avalon.require(["../demo/" + target.text + "/" + target.text],function(init){
						target.loading = false;
						init(targetNode);
					});
				}
				bodyVm.curIndex = i;
			}
		});
		avalon.bindingHandlers.code = function(data){
			var html = data.element.innerHTML;
			data.element.innerHTML = '';
			var arr = html.split("\n");
			var first = arr[0];
			var re = first.match(/^\s*/);
			for(var i=0,ii=arr.length;i<ii;i++){
				arr[i] = arr[i].replace(re[0],"");
			}
			if(/^\s*$/.test(arr[ii - 1])){
				arr.pop();
			}
			data.element.appendChild(document.createTextNode(arr.join("\n")));
		};
		avalon.bindingHandlers.parentwin = function(data,vmodel){
			var options = avalon.bindingHandlers.parentwin[data.value];
			options.content = data.element.innerHTML;
			parent.avalon.initDialog(data.value,options);
			data.element.parentNode.removeChild(data.element);
			data.element = null;
		};
		avalon.scan();
		bodyVm.changeIndex(0);
	})();
</script>
</body>
</html>